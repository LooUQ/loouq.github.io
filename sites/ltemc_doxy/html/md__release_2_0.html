<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LTEmC: Release_2_0</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="LooUQ-Logo(240x100-t).png"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LTEmC
   &#160;<span id="projectnumber">v2.3.0</span>
   </div>
   <div id="projectbrief">C device driver for LooUQ LTE cellular modems</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Release_2_0 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>Release 2.0</p>
<p>LooUQ is ready for tomorrow with the release of LTEmC version 2. Version 2 started in early June as version 1.1, intending to add HTTP support and the ability to dynamically load/unload protocols. To accomplish these goals it became apparent these objectives, there were some structural changes required. As these started being tackled, it took on a life of its own and numerous previously indentified issues got folded in to create the LTEmC that would stand up to the demands of the next several years; including additional protocols, support for 2 new modem models planned for the next 6 months, and new hardware features.</p>
<p>The primary goal of the version 2.0 release is to enable the above future roadmap with little or no change to the exposed public API. LooUQ has accomplished this by reversing several dependencies and giving the application ownership of the data buffers and encapsulation of the protocol controls (sockets, MQTT, HTTP, etc.).</p>
<p>Previous versions of LTEmC allocated all buffers and protocol controls (structs). This resulted in memory bload, as the worse-case assumtions lead to larger buffers and multiple storage locations for protocol controls. This approach has been replaced with application defined (owned) data receive buffers and protocol controls.</p><ul>
<li>At a minimum, to implement a protocol, your application will need to create a receive buffer (rxBuffer) and a protocol control. LTEmC only references these via pointers.<ul>
<li>These can be local variables, if short lived.</li>
<li>They can be dynamic and created by malloc().</li>
<li>Or, they can be global variables.</li>
</ul>
</li>
<li>Protocol instances can share a rxBuffer. <em>Theoretically it is possible for different protocols to share a buffer but this has not been tested.</em></li>
<li>Each protocol has an _initControl() function to initialize your protocol instance control.</li>
<li>There are 6 protocol "slots" defined in an enum as dataContext_0 through dataContext_5 the a protocol instance can be assigned to.</li>
<li>In version 2.1, with support added for the BGx file system, there is a special slot streamPeer_6.</li>
<li>Use of the <a class="el" href="ltemc_8c.html#a5b79bd67186c40d469be1bcc5dcd412b" title="Background work task runner. To be called in application Loop() periodically.">ltem_doWork()</a> function in the application's main loop() is only required if your application utilizes protocols with asynchronous receive events. Sockets and MQTT both have asynchronous receive behavior; HTTP(S) receives are fully synchronous with page funtions.</li>
</ul>
<h2><a class="anchor" id="autotoc_md30"></a>
Example Code Setup</h2>
<p>``` // LTEm variables mqttCtrl_t mqttCtrl; // MQTT control, data to manage MQTT connection to server uint8_t receiveBuffer[640]; // Data buffer where received information is returned (can be local, global, or dynamic... your call)</p>
<p>char mqttTopic[200]; // application buffer to craft TX MQTT topic char mqttMessage[200]; // application buffer to craft TX MQTT publish content (body) resultCode_t result;</p>
<pre class="fragment">void setup() 
{
    /* define a global ltemc instance, then initialize and start communications */
    ltem_create(ltem_pinConfig, appNotifyCB);
    ltem_start();

    /* setup SSL\TLS if your application requires it MQTT over TLS or HTTPS, then initialize your protocol(s) */
    tls_configure(dataContext_5, tlsVersion_tls12, tlsCipher_default, tlsCertExpiration_default, tlsSecurityLevel_default);
    mqtt_initControl(&amp;mqttCtrl, dataContext_5, mqtt__useTls, mqttVersion_311, receiveBuffer, sizeof(receiveBuffer), mqttRecvCB);

    /* do whatever your protocol needs to start host communications, here it is open, connect, and subscribe to topics */
    rslt = mqtt_open(&amp;mqttCtrl, MQTT_IOTHUB, MQTT_PORT);
    rslt = mqtt_connect(&amp;mqttCtrl, MQTT_IOTHUB_DEVICEID, MQTT_IOTHUB_USERID, MQTT_IOTHUB_SASTOKEN, mqttSession_cleanStart);
    rslt = mqtt_subscribe(&amp;mqttCtrl, MQTT_IOTHUB_C2D_TOPIC, mqttQos_1);
}

void loop()
{
    /* compose your MQTT message into a topic and message */
    snprintf(mqttTopic, 200, MQTT_MSG_BODY_TEMPLATE, loopCnt, windspeed);
    snprintf(mqttMessage, 200, "MQTT message for loop=%d", loopCnt);
    mqtt_publish(&amp;mqttCtrl, mqttTopic, mqttQos_1, mqttMessage);

    /* MQTT support asychronous background message receives,
     * ltem_doWork() marshals the received data back to your application via the receive callback  */
    ltem_doWork();
}
</pre><p>To fully understand how to setup each of the currently supported protocols (Sockets, MQTT, and HTTP), review the associated "test" INO file. Each of these have numerous comments on the protocol's setup and can serve as a blueprint for your application if running under the Arduino framework. If you have questions, please reach out by messaging <a href="#" onclick="location.href='mai'+'lto:'+'ans'+'we'+'rs@'+'lo'+'ouq'+'.c'+'om'; return false;">answe<span style="display: none;">.nosp@m.</span>rs@l<span style="display: none;">.nosp@m.</span>oouq.<span style="display: none;">.nosp@m.</span>com</a>. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="http://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.8.20
</small></address>
</body>
</html>
